name: Auto Import Games

on:
  schedule:
    - cron: "0 3 * * *"   # Tous les jours Ã  03h00 UTC
  workflow_dispatch:       # Permet de le lancer manuellement si besoin

jobs:
  import-games:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install dependencies
        run: sudo apt-get install -y wget jq unzip

      - name: Create games folder
        run: mkdir -p assets/games

      - name: Download 10 random free games
        run: |
          cd assets/games
          echo "TÃ©lÃ©chargement de 10 jeux gratuits..."
          for i in {1..10}; do
            id=$(echo $RANDOM)
            wget -q "https://archive.org/download/classic-pc-games_${id}/game${i}.zip" -O "game${i}.zip" || true
          done

      - name: Commit new games
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add assets/games
          git commit -m "Ajout automatique de 10 nouveaux jeux ðŸŽ®" || echo "Aucun nouveau jeu Ã  ajouter"
          git push

      - name: Trigger Netlify rebuild
        run: |
          curl -X POST -d {} https://api.netlify.com/build_hooks/${{ secrets.NETLIFY_BUILD_HOOK }}
